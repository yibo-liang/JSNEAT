<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>XorTest</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="JSGAFramework.js"></script>
        <script src="NEATimp.js"></script>
    </head>
    <body>
        <script>
            var obj = initNEATPool(2, 1, 20);
            var genomes = obj.genomes;
            var npool = obj.pool;
            var inputvecs = [[0, 0], [0, 1], [1, 0], [1, 1]];


            function xor(a, b) {
                var l1;
                var l2;
                if (a === 0) {
                    l1 = false;
                } else {
                    l1 = true;
                }

                if (b === 0) {
                    l2 = false;
                } else {
                    l2 = true;
                }
                return (l1 || l2) && !(l1 && l2);
            }
            var done = false;
            var resultGenome;
            var gen = 0;

            do {
                for (var d = 0; d < npool.species.length; d++) {
                    var species = npool.species[d];
                    //for each genome in this species
                    for (var e = 0; e < species.genomes.length; e++) {
                        var genome = species.genomes[e];
                        //console.log(species, e);
                        generateNN(genome.chromesomes["NEAT"]);
                        var c = 0;
                        for (var k = 0; k < inputvecs.length; k++) {
                            //console.log("input=", inputvec[k]);
                            var network = genome.properties["NeuroNetwork"];
                            var output = evaluateNeuroNetwork(genome, network, inputvecs[k]);

                            var answer = output[0] > 0 ? true : false;


                            var correctAnswer = xor(inputvecs[k][0], inputvecs[k][1]);
                            //console.log("output=", answer, "correct=", correctAnswer);
                            if (answer === correctAnswer) {
                                c++;
                            }
                        }

                        genome.fitness = c / 4;
                        if (genome.fitness > npool.maxFitness) {
                            npool.maxFitness = genome.fitness;
                            console.log("new max fitness = " + npool.maxFitness);
                        }
                        if (c === 4) {
                            done = true;
                            resultGenome = genome;
                            break;
                        }

                    }
                    if (done === true) {
                        break;
                    }

                }
                nextGeneration(npool);
                gen++;
            } while (!done && gen < 500);
            console.log(resultGenome);
            console.log("gen = " + npool.generation, npool);
        </script>
    </body>
</html>
